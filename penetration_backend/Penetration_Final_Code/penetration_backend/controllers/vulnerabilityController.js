const Vulnerability = require("../models/vulnerabilityScan");

// const createScan = async ({ body }) => {
//   const { target, scanResults, overallRisk } = body;


//   if (!target || !scanResults) {
//     console.error("Target and scan results are required");
//     throw new Error("Target and scan results are required");
//   }

//   try {
//     const newScan = new Vulnerability({
//       target,
//       scanResults,
//       riskPercentage: overallRisk,
//     });

//     await newScan.save();
//     console.log("Vulnerability scan result saved successfully");
//     return newScan;
//   } catch (error) {
//     console.error("Error saving vulnerability scan result:", error.message);
//     throw new Error("Failed to save vulnerability scan result");
//   }
// };

// Create Scan Function
const createScan = async (scanData) => {
  console.log("Received Scan Data in Controller:", scanData);

  const { target, scanResults, riskPercentage } = scanData;

  if (!target || !scanResults) {
    throw new Error("Missing required fields");
  }

  // Save to MongoDB
  const newScan = new Vulnerability({ target, scanResults, riskPercentage });
  await newScan.save();

  console.log("Scan Saved Successfully");
  return newScan;
};

// Get All Scans
const getAllScans = async (req, res) => {
  try {
    const scans = await Vulnerability.find();
    res.status(200).json(scans);
  } catch (error) {
    res.status(500).json({ error: "Failed to fetch scans" });
  }
};

// Get Scan by ID
const getScanById = async (req, res) => {
  try {
    const scan = await Vulnerability.findById(req.params.id);
    if (!scan) {
      return res.status(404).json({ error: "Scan not found" });
    }
    res.status(200).json(scan);
  } catch (error) {
    res.status(500).json({ error: "Failed to fetch scan" });
  }
};

module.exports = { createScan, getAllScans, getScanById };
